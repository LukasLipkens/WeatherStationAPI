name: Publish WebApi And MQTT

on:
  workflow_dispatch: # manual trigger
  create:
    branches:
      - 'live'

permissions:
  contents: read

jobs:
  build-publish_webapi:
    uses: ./.github/workflows/docker-steps.yml
    with:
      context: .
      dockerfile: ./src/UCLL.Projects.WeatherStations.WebApi/Dockerfile
      tags: |
        docker.io/weatherstations/ucll.projects.weatherstations.webapi:latest
        docker.io/weatherstations/ucll.projects.weatherstations.webapi:${{ github.sha }}

  build-publish_mqtt:
    uses: ./.github/workflows/docker-steps.yml
    with:
      context: .
      dockerfile: ./src/UCLL.Projects.WeatherStations.MQTT/Dockerfile
      tags: |
        docker.io/weatherstations/ucll.projects.weatherstations.mqtt:latest
        docker.io/weatherstations/ucll.projects.weatherstations.mqtt:${{ github.sha }}
